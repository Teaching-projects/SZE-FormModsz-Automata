<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>// Place global declarations here.
chan coin, coffe, tea, refund, ready, empty;
int coins_back = 0;

bool reserved;

clock seconds;</declaration><template><name x="5" y="5">CoffeMachine</name><declaration>// Place local declarations here.
int coffe_nr = 3, tea_nr = 3, coins_in = 0;</declaration><location id="id0" x="144" y="-168"><name x="134" y="-198">Reload_tea</name></location><location id="id1" x="-136" y="-168"><name x="-216" y="-200">Reload_coffe</name></location><location id="id2" x="16" y="272"><name x="-48" y="248">Coin_2</name></location><location id="id3" x="352" y="256"><name x="240" y="248">Tea_preparing</name><label kind="invariant" x="312" y="272">seconds&lt;20</label></location><location id="id4" x="-112" y="448"><name x="-224" y="424">Coffe_preparing</name><label kind="invariant" x="-152" y="464">seconds&lt;30</label></location><location id="id5" x="352" y="160"><name x="342" y="130">Tea_pushed</name></location><location id="id6" x="-112" y="328"><name x="-216" y="312">Coffe_pushed</name></location><location id="id7" x="16" y="96"><name x="-48" y="88">Coin_1</name></location><location id="id8" x="16" y="-40"><name x="8" y="-80">Init</name></location><init ref="id8"/><transition><source ref="id0"/><target ref="id8"/><label kind="assignment" x="152" y="-120">tea_nr = 3</label><nail x="152" y="-72"/></transition><transition><source ref="id8"/><target ref="id0"/><label kind="guard" x="32" y="-152">tea_nr == 0</label></transition><transition><source ref="id1"/><target ref="id8"/><label kind="assignment" x="-208" y="-120">coffe_nr = 3</label><nail x="-120" y="-64"/></transition><transition><source ref="id8"/><target ref="id1"/><label kind="guard" x="-96" y="-152">coffe_nr == 0</label></transition><transition><source ref="id2"/><target ref="id5"/><label kind="synchronisation" x="136" y="208">tea?</label></transition><transition><source ref="id2"/><target ref="id2"/><label kind="synchronisation" x="80" y="312">coin?</label><label kind="assignment" x="176" y="376">coins_in ++</label><nail x="192" y="344"/><nail x="160" y="408"/></transition><transition><source ref="id4"/><target ref="id8"/><label kind="guard" x="-352" y="208">seconds &gt;= 10</label><label kind="synchronisation" x="-296" y="-40">ready!</label><label kind="assignment" x="-296" y="-24">coffe_nr --,
coins_back = coins_in -2,
reserved = 0</label><nail x="-360" y="448"/><nail x="-360" y="-40"/></transition><transition><source ref="id6"/><target ref="id2"/><label kind="guard" x="-72" y="328">coffe_nr == 0</label><label kind="synchronisation" x="-72" y="344">empty!</label><nail x="16" y="328"/></transition><transition><source ref="id7"/><target ref="id8"/><label kind="synchronisation" x="144" y="24">refund?</label><label kind="assignment" x="144" y="40">coins_back = coins_in,
reserved = 0</label><nail x="136" y="32"/></transition><transition><source ref="id2"/><target ref="id8"/><label kind="synchronisation" x="-200" y="80">refund?</label><label kind="assignment" x="-280" y="96">coins_back = coins_in,
reserved = 0</label><nail x="-144" y="96"/></transition><transition><source ref="id2"/><target ref="id6"/><label kind="synchronisation" x="-80" y="280">coffe?</label></transition><transition><source ref="id7"/><target ref="id2"/><label kind="synchronisation" x="-24" y="136">coin?</label><label kind="assignment" x="-64" y="152">coins_in ++</label></transition><transition><source ref="id3"/><target ref="id8"/><label kind="guard" x="464" y="88">seconds &gt;= 10</label><label kind="synchronisation" x="280" y="-40">ready!</label><label kind="assignment" x="280" y="-24">tea_nr --,
coins_back = coins_in -1,
reserved = 0</label><nail x="448" y="256"/><nail x="448" y="-40"/></transition><transition><source ref="id5"/><target ref="id7"/><label kind="guard" x="48" y="152">tea_nr == 0</label><label kind="synchronisation" x="48" y="168">empty!</label><nail x="32" y="152"/></transition><transition><source ref="id5"/><target ref="id3"/><label kind="guard" x="352" y="192">tea_nr != 0</label></transition><transition><source ref="id6"/><target ref="id4"/><label kind="guard" x="-200" y="376">coffe_nr != 0</label></transition><transition><source ref="id7"/><target ref="id5"/><label kind="synchronisation" x="152" y="104">tea?</label></transition><transition><source ref="id8"/><target ref="id7"/><label kind="synchronisation" x="-24" y="8">coin?</label><label kind="assignment" x="-64" y="24">coins_in ++,
reserved = 1</label></transition></template><template><name>Customer</name><declaration>int blood_pressure = 110, coins = 4;
</declaration><location id="id9" x="-312" y="88"><name x="-304" y="96">Coin_2</name></location><location id="id10" x="208" y="384"><name x="232" y="368">Cardiologist</name><urgent/></location><location id="id11" x="-312" y="384"><name x="-352" y="400">Drink_ready</name></location><location id="id12" x="-144" y="88"><name x="-120" y="80">Tea_pushed</name><label kind="invariant" x="-136" y="96">seconds &lt;= 30</label></location><location id="id13" x="-480" y="208"><name x="-584" y="200">Coffe_pushed</name><label kind="invariant" x="-568" y="224">seconds &lt;= 30</label></location><location id="id14" x="-312" y="-48"><name x="-376" y="-72">Coin_1</name></location><location id="id15" x="-312" y="-208"><name x="-322" y="-238">Init</name></location><init ref="id15"/><transition><source ref="id13"/><target ref="id9"/><label kind="synchronisation" x="-400" y="208">empty?</label><label kind="assignment" x="-400" y="224">blood_pressure += 25</label><nail x="-312" y="208"/></transition><transition><source ref="id10"/><target ref="id15"/><label kind="assignment" x="144" y="32">coins = 0</label><nail x="216" y="-208"/></transition><transition><source ref="id12"/><target ref="id11"/><label kind="synchronisation" x="-136" y="160">ready?</label><nail x="-144" y="272"/></transition><transition><source ref="id9"/><target ref="id15"/><label kind="synchronisation" x="-464" y="-184">refund!</label><label kind="assignment" x="-552" y="-168">coins += coins_back</label><nail x="-528" y="-96"/></transition><transition><source ref="id9"/><target ref="id9"/><label kind="guard" x="-464" y="32">coins &gt; 0</label><label kind="synchronisation" x="-496" y="48">coin!</label><label kind="assignment" x="-496" y="64">coins --</label><nail x="-448" y="56"/><nail x="-448" y="88"/></transition><transition><source ref="id9"/><target ref="id12"/><label kind="synchronisation" x="-264" y="64">tea!</label></transition><transition><source ref="id9"/><target ref="id13"/><label kind="synchronisation" x="-448" y="144">coffe!</label></transition><transition><source ref="id14"/><target ref="id9"/><label kind="guard" x="-376" y="-24">coins &gt; 0</label><label kind="synchronisation" x="-376" y="-9">coin!</label><label kind="assignment" x="-376" y="6">coins --</label></transition><transition><source ref="id12"/><target ref="id14"/><label kind="synchronisation" x="-192" y="-32">empty?</label><label kind="assignment" x="-216" y="-72">blood_pressure += 25</label><nail x="-144" y="-48"/></transition><transition><source ref="id13"/><target ref="id11"/><label kind="synchronisation" x="-480" y="264">ready?</label><label kind="assignment" x="-536" y="288">blood_pressure += 20</label></transition><transition><source ref="id11"/><target ref="id10"/><label kind="guard" x="-184" y="360">blood_pressure &gt; 150</label></transition><transition><source ref="id14"/><target ref="id15"/><label kind="synchronisation" x="-256" y="-200">refund!</label><label kind="assignment" x="-232" y="-184">coins += coins_back</label><nail x="-208" y="-152"/></transition><transition><source ref="id11"/><target ref="id15"/><label kind="guard" x="-744" y="360">blood_pressure &lt;= 150</label><label kind="assignment" x="-744" y="392">seconds := 0,
coins += coins_back</label><nail x="-808" y="384"/><nail x="-808" y="-208"/></transition><transition><source ref="id14"/><target ref="id12"/><label kind="synchronisation" x="-272" y="-32">tea!</label></transition><transition><source ref="id15"/><target ref="id14"/><label kind="guard" x="-376" y="-144">coins &gt; 0 and !reserved</label><label kind="synchronisation" x="-376" y="-160">coin!</label><label kind="assignment" x="-376" y="-128">coins --</label></transition></template><system>// Place template instantiations here.
Machine = CoffeMachine();
Zoli = Customer();
Sanyi = Customer();

// List one or more processes to be composed into a system.
system Machine, Zoli, Sanyi;</system></nta>